<app-page-header [title]="'Invoice'" [title1]="['Invoice']" [activeitem]="(pageType | titlecase) + ' Invoice'"></app-page-header>
<div class="box" *ngIf="skLoading">
    <div class="p-4">
        <div class="grid grid-cols-12 gap-x-6">
            <div class="xl:col-span-3 col-span-12 mb-4" *ngFor="let card of [].constructor(10)">
                <app-skeleton></app-skeleton>
            </div>
        </div>
    </div>
</div>
<div class="xl:col-span-12 col-span-12" *ngIf="!skLoading">
    
    <form [formGroup]="invoiceForm" (ngSubmit)="onSubmit()">
        <div class="box">
            <div class=" p-4">
                <p class="text-[14px] mb-2 font-semibold text-primarytint1color">BILLING INFORMATION</p>
                <div class="grid grid-cols-12 sm:gap-x-6">
                    
                    <div class="xl:col-span-3 col-span-12 mb-3">
                        <spk-input label="Billing Company"  formControlName="billing_to_company" [fieldReq]="true" class="remove-default-class" type="text"></spk-input>
                    </div>
                    
                    <div class="xl:col-span-3 col-span-12 mb-3">
                        <spk-input label="Billing Contact"  formControlName="billing_to_contact" [fieldReq]="true" class="remove-default-class" type="text"></spk-input>
                    </div>
                    
                    <div class="xl:col-span-3 col-span-12 mb-3">
                        <spk-input label="Billing Mobile"  formControlName="billing_to_mobile" [fieldReq]="true" class="remove-default-class" type="text" (keypress)="formValidation.handleInputFilter($event, 'mobile')"></spk-input>
                    </div>
                    
                    <div class="xl:col-span-3 col-span-12 mb-3">
                        <spk-input label="Billing Email"  formControlName="billing_to_email" [fieldReq]="true" class="remove-default-class" type="text"></spk-input>
                    </div>
                    
                    <div class="xl:col-span-3 col-span-12 mb-3">
                        <spk-input label="Billing GST" formControlName="billing_to_gst_no" [fieldReq]="false" class="remove-default-class" type="text"></spk-input>
                    </div>
                    
                    <div class="xl:col-span-6 col-span-12 mb-3">
                        <spk-input label="Billing Address" formControlName="billing_to_address" [fieldReq]="false" class="remove-default-class" type="textarea"></spk-input>
                    </div>
                </div>
                
                <div class="dropdown-divider my-2 border"></div>
                
                <p class="text-[14px] mb-2 font-semibold text-primarytint1color">SHIPPING INFORMATION</p>
                <div class="grid grid-cols-12 sm:gap-x-6">
                    <div class="xl:col-span-3 col-span-12 mb-3">
                        <spk-input label="Shipping Company"  formControlName="shipping_to_company" [fieldReq]="true" class="remove-default-class" type="text"></spk-input>
                    </div>
                    
                    <div class="xl:col-span-3 col-span-12 mb-3">
                        <spk-input label="Shipping Contact"  formControlName="shipping_to_contact" [fieldReq]="true" class="remove-default-class" type="text"></spk-input>
                    </div>
                    
                    <div class="xl:col-span-3 col-span-12 mb-3">
                        <spk-input label="Shipping Mobile"  formControlName="shipping_to_mobile" [fieldReq]="true" class="remove-default-class" type="text" (keypress)="formValidation.handleInputFilter($event, 'mobile')"></spk-input>
                    </div>
                    
                    <div class="xl:col-span-3 col-span-12 mb-3">
                        <spk-input label="Shipping Email"  formControlName="shipping_to_email" [fieldReq]="true" class="remove-default-class" type="text"></spk-input>
                    </div>
                    
                    <div class="xl:col-span-3 col-span-12 mb-3">
                        <spk-input label="Shipping GST" formControlName="shipping_to_gst_no" [fieldReq]="false" class="remove-default-class" type="text"></spk-input>
                    </div>
                    
                    <div class="xl:col-span-6 col-span-12 mb-3">
                        <spk-input label="Shipping Address" formControlName="shipping_to_address" [fieldReq]="false" class="remove-default-class" type="textarea"></spk-input>
                    </div>
                </div>
                
                <div class="dropdown-divider my-2 border"></div>
                
                <div class="grid grid-cols-12 sm:gap-x-6">
                    <div class="xl:col-span-3 col-span-12 mb-3">
                        <spk-ng-select 
                        formControlName="customer_type_id" 
                        label="Customer Type"
                        [fieldReq]="true"
                        [options]="CommonApiService.customerTypeData"
                        (selectedChange)="CommonApiService.getCustomerData('', $event,'','')"></spk-ng-select>
                    </div>
                    
                    <div class="xl:col-span-3 col-span-12 mb-3">
                        <spk-ng-select 
                        formControlName="customer_id" 
                        label="Customer"  
                        [fieldReq]="true"
                        [search]="true"
                        (searchChanged)="onSearch($event , 'customer')"
                        [options]="CommonApiService.customerData"
                        (selectedChange)="findName($event, 'customer_name');"></spk-ng-select>
                    </div>
                    
                    <div class="xl:col-span-3 col-span-12">
                        <spk-flatpickr
                        placeholder="Invoice Date"
                        label="Invoice Date"
                        [fieldReq]="true" 
                        [max]="today"
                        class="form-control custom-datepickr"
                        formControlName="billing_date"></spk-flatpickr>
                    </div>
                    
                    <div class="xl:col-span-3 col-span-12 mb-3">
                        <spk-input label="Invoice No"  formControlName="invoice_number" [fieldReq]="true" class="remove-default-class" type="text"></spk-input>
                    </div>
                    
                    <div class="xl:col-span-6 col-span-12 mb-3">
                        <label class="form-label mb-0">Attachment (PDF)<span class="text-red-500">*</span></label>
                        <file-pond 
                        class="filepond basic-filepond" 
                        [options]="pondDocumentOptions" 
                        [files]="pondAttachmentFiles"
                        (onremovefile)="onFileRemove($event, 'pdf')"
                        (onprocessfile)="onFileProcessed($event, 'pdf')"></file-pond>
                    </div>
                </div>
                
                <div class="dropdown-divider my-2 border"></div>
                
                <p class="text-[14px] mb-2 font-semibold text-primarytint1color">PRODUCT INFORMATION</p>
                <div class="grid grid-cols-12 sm:gap-x-3">
                    <div class="xxl:col-span-3 xl:col-span-6 lg:col-span-6 md:col-span-6 col-span-12">
                        <spk-ng-select 
                        formControlName="product_id" 
                        label="Select Product" 
                        [search]="true"
                        (searchChanged)="onSearch($event , 'product')"
                        [options]="CommonApiService.productList"
                        (selectedChange)="findName($event, 'product_name');"></spk-ng-select>
                    </div>
                    <div class="xxl:col-span-3 xl:col-span-6 lg:col-span-6 md:col-span-6 col-span-12">
                        <spk-input 
                        label="QTY" 
                        formControlName="total_quantity" 
                        class="remove-default-class" 
                        type="number"></spk-input>
                    </div>
                    
                    <div class="xl:col-span-3 col-span-12 mb-3">
                        <div class="flex gap-4 justify-center items-center ">
                            <spk-input 
                            label="Batch No."  
                            formControlName="batch_no" 
                            [fieldReq]="true" 
                            class="remove-default-class" 
                            type="text"></spk-input>
                            
                            <button type="button" aria-label="button" class="ti-btn mt-6 ti-btn-icon ti-btn-primary btn-wave" (click)="addToList()">
                                <i class="ri-add-line"></i>
                            </button>
                        </div>
                    </div>
                    
                </div>
                
                <div class="grid grid-cols-12 sm:gap-x-3" *ngIf="invoiceList?.length">
                    <div class="xxl:col-span-12 xl:col-span-6 lg:col-span-6 md:col-span-6 col-span-12">
                        <div class="table-responsive overflow-auto table-bordered-default mt-4 mb-4" >
                            <spk-reusable-tables [columns]="headerColumn" tableClass="ti-custom-table ti-custom-table-head ti-custom-table-hover ti-head-primary whitespace-nowrap" [tableHead]="'border-b'" [showS_No]="true" [showAction]="true">
                                <tr class="product-list border-b !border-defaultborder dark:!border-defaultborder/10" *ngFor="let row of invoiceList; let i = index;">
                                    <td class="w60 text-center">{{i+1}}</td>
                                    <td>{{row.product_name}}</td>
                                    <td>{{row.product_code}}</td>
                                    <td>{{row.total_quantity}}</td>
                                    <td>{{row.square_meter}}</td>
                                    <td>{{row.batch_no}}</td>
                                    <td>{{row.product_grade}}</td>
                                    <td>{{row.color_code}}</td>
                                    <td>{{row.length}}</td>
                                    <td>{{row.width}}</td>
                                    <td class="w60 relative">
                                        <div class="flex flex-row items-center !gap-2 text-[0.9375rem]">
                                            <app-icon-button [icon]="'ri-delete-bin-line'" [buttonClass]="'ti-btn btn-wave product-btn ti-btn-sm ti-btn-soft-danger waves-effect waves-light'" (clickEvent)="deleteRow(i)"></app-icon-button>
                                        </div>
                                    </td>
                                </tr>
                            </spk-reusable-tables>
                        </div>
                    </div>
                </div>
                
                <div class="box-footer border-t border-block-start-dashed sm:flex justify-end mt-4">
                    <app-button [buttonType]="'submit'" [buttonClass]="'ti-btn ti-btn-primary m-0'" [disabled]="api.disabled" [formType]="pageType" [iconClass]="'ri-save-line'"  [loadingIconClass]="'ri-loader-2-fill'"></app-button>
                </div>
            </div>            
        </div>
    </form>
</div>

